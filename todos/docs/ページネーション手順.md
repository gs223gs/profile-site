# ページネーション手順

## 概要
GitHub APIを使用してリポジトリ情報を取得する際のページネーション実装手順

## 実装手順

### 1. Server Actionの呼び出し
```tsx
import { getUserRepositories } from '@/app/actions/getUserRepositories';

// 初回データ取得
const initialData = await getUserRepositories();

// 次のページを取得
const nextPageData = await getUserRepositories({
  after: currentPageInfo.endCursor
});
```

### 2. 状態管理
```tsx
const [repositories, setRepositories] = useState<Repository[]>([]);
const [pageInfo, setPageInfo] = useState<PageInfo | null>(null);
const [loading, setLoading] = useState(false);
```

### 3. データの追加処理
```tsx
const loadMoreRepositories = async () => {
  if (!pageInfo?.hasNextPage) return;
  
  setLoading(true);
  try {
    const newData = await getUserRepositories({
      after: pageInfo.endCursor
    });
    
    setRepositories(prev => [...prev, ...newData.repositories]);
    setPageInfo(newData.pageInfo);
  } catch (error) {
    console.error('Failed to load more repositories:', error);
  } finally {
    setLoading(false);
  }
};
```

### 4. UIでの表示
```tsx
return (
  <div>
    {repositories.map(repo => (
      <RepositoryCard key={repo.id} repository={repo} />
    ))}
    
    {pageInfo?.hasNextPage && (
      <Button onClick={loadMoreRepositories} disabled={loading}>
        {loading ? 'Loading...' : 'Load More'}
      </Button>
    )}
  </div>
);
```

## パラメータ

- `first`: 取得する件数（デフォルト: 10）
- `after`: 開始位置のカーソル（次のページ取得時に使用）
- `login`: GitHubユーザー名（デフォルト: 'gs223gs'）

## 注意点

1. **カーソルベースページネーション**: GitHub APIはカーソルベースのため、`endCursor`を使用して次のページを取得
2. **重複チェック**: 同じリポジトリが重複して追加されないよう、必要に応じてチェック
3. **エラーハンドリング**: ネットワークエラーやAPI制限エラーの適切な処理
4. **ローディング状態**: ユーザーエクスペリエンスのためのローディング表示

## 実装例

```tsx
'use client';

import { useEffect, useState } from 'react';
import { getUserRepositories } from '@/app/actions/getUserRepositories';
import type { Repository, PageInfo } from '@/types/repository';

export default function RepositoryPage() {
  const [repositories, setRepositories] = useState<Repository[]>([]);
  const [pageInfo, setPageInfo] = useState<PageInfo | null>(null);
  const [loading, setLoading] = useState(true);
  const [loadingMore, setLoadingMore] = useState(false);

  useEffect(() => {
    const fetchInitialData = async () => {
      try {
        const data = await getUserRepositories();
        setRepositories(data.repositories);
        setPageInfo(data.pageInfo);
      } catch (error) {
        console.error('Failed to fetch repositories:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchInitialData();
  }, []);

  const loadMore = async () => {
    if (!pageInfo?.hasNextPage || loadingMore) return;
    
    setLoadingMore(true);
    try {
      const data = await getUserRepositories({
        after: pageInfo.endCursor
      });
      
      setRepositories(prev => [...prev, ...data.repositories]);
      setPageInfo(data.pageInfo);
    } catch (error) {
      console.error('Failed to load more repositories:', error);
    } finally {
      setLoadingMore(false);
    }
  };

  if (loading) return <div>Loading...</div>;

  return (
    <div>
      {repositories.map(repo => (
        <div key={repo.id}>
          <h3>{repo.name}</h3>
          <p>{repo.description}</p>
        </div>
      ))}
      
      {pageInfo?.hasNextPage && (
        <button onClick={loadMore} disabled={loadingMore}>
          {loadingMore ? 'Loading...' : 'Load More'}
        </button>
      )}
    </div>
  );
}
```